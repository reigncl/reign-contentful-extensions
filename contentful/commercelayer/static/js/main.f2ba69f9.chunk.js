(this["webpackJsonp@contentful/commercelayer-products"]=this["webpackJsonp@contentful/commercelayer-products"]||[]).push([[0],{253:function(e,t,n){"use strict";n.r(t);var a=n(85),i=n.n(a),o=n(49),r=n.n(o),s=n(86),c=n.n(s),l=n(87),p=n.n(l),d=n(50),u=n.p+"static/media/logo.73d2f416.svg",m=n(11),h=n.n(m);const f=e=>t=>{const{id:n}=t;return{id:n,image:h()(t,["imageUrl"])||h()(t,["attributes","image_url"]),name:h()(t,["name"])||h()(t,["attributes","name"]),sku:h()(t,["code"])||h()(t,["attributes","code"]),externalLink:`${e}/admin/skus/${n}/edit`}},y="root";let g=null;function w(e){return"Array"===e?"Select products":"Select a product"}function k(e){return e.clientId.length<1?"Provide your Sales Channel client ID.":e.apiEndpoint.length<1||!e.apiEndpoint.startsWith("https://")?"Provide a valid Sales Channel API endpoint.":e.scope.length<1||!e.scope.startsWith("market:")||!e.scope.startsWith("stock_location:")?"Provide a valid Sales Channel scope.":null}async function C(e,t,n){return g||(g=(await i.a.getIntegrationToken({clientId:e,endpoint:t.startsWith("https://")?t:`https://${t}`,clientSecret:"",scope:n})).accessToken),g}const P=async function(e,t){if(!e.length)return[];const{clientId:n,apiEndpoint:a,scope:i}=t,o=await C(n,a,i),s=c()(e,25).map((async e=>{const t=`${a}/api/skus?page[size]=25&filter[q][code_in]=${e}`,n=await fetch(t,{headers:{Accept:"application/vnd.api+json",Authorization:`Bearer ${o}`},method:"GET"});return await n.json()})),l=await Promise.all(s),d=p()(l,(({data:e})=>e.map(f(t.apiEndpoint)))),u=r()(e,d.map((e=>e.sku))).map((e=>({sku:e,isMissing:!0,image:"",name:"",id:""})));return[...d,...u]};Object(d.setup)({makeCTA:w,name:"Commerce Layer",logo:u,description:"The Commerce Layer app allows editors to select products from their Commerce Layer account and reference them inside of Contentful entries.",color:"#212F3F",parameterDefinitions:[{id:"clientId",name:"Client ID",description:"The client ID of your Sales Channel",type:"Symbol",required:!0},{id:"apiEndpoint",name:"API Endpoint",description:'Sales Channel API endpoint (e.g., "https://acme.commercelayer.io")',type:"Symbol",required:!0},{id:"scope",name:"Scope",description:'Allowed scope for Sales Channel (e.g., "market:1234")',type:"Symbol",required:!0}],fetchProductPreviews:P,renderDialog:async function(e){const t=document.getElementById(y);t.style.display="flex",t.style.flexDirection="column",Object(d.renderSkuPicker)(y,{sdk:e,fetchProductPreviews:P,fetchProducts:async(t,n)=>{const a=await async function(e,t,n){const a=k(e);if(a)throw new Error(a);const{clientId:i,apiEndpoint:o,scope:r}=e,s=await C(i,o,r),c=`${o}/api/skus?page[size]=20&page[number]=${n.offset/20+1}${t.length?`&filter[q][name_or_code_cont]=${t}`:""}`,l=await fetch(c,{headers:{Accept:"application/vnd.api+json",Authorization:`Bearer ${s}`},method:"GET"});return await l.json()}(e.parameters.installation,t,n);return{pagination:{count:20,limit:20,total:a.meta.record_count,offset:n.offset},products:a.data.map(f(e.parameters.installation.apiEndpoint))}}}),e.window.startAutoResizer()},openDialog:async function(e,t,n){const a=await e.dialogs.openCurrentApp({allowHeightOverflow:!0,position:"center",title:w(e.field.type),shouldCloseOnOverlayClick:!0,shouldCloseOnEscapePress:!0,parameters:n,width:1400});return Array.isArray(a)?a:[]},isDisabled:function(){return!1},validateParameters:k})},96:function(e,t){}},[[253,1,2]]]);
//# sourceMappingURL=main.f2ba69f9.chunk.js.map